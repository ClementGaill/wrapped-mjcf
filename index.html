<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ton Profil Militant 2025</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@400;700;800;900&family=Poppins:wght@400;600;800&display=swap"
        rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        /* --- RESET ET VARIABLES GLOBALES --- */
        :root {
            --jc-red: #E93F3F;
            --jc-yellow: #FFE781;
            --white: #ffffff;
            --principal: rgba(233, 63, 63, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- STYLE DE L'APP (INTERFACE UTILISATEUR) --- */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--jc-red);
            min-height: 100vh;
            width: 100vw;
            overflow: hidden;
            /* Emp√™che le scroll √† cause du canvas cach√© */
            color: var(--jc-red);
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .background-blobs {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            background: radial-gradient(circle at 80% 20%, var(--jc-yellow) 0%, transparent 50%), radial-gradient(circle at 20% 80%, var(--jc-yellow) 0%, transparent 40%), radial-gradient(circle at 50% 50%, #ff5e5e 0%, var(--jc-red) 70%);
            filter: blur(40px);
            opacity: 0.9;
            pointer-events: none;
        }

        .noise-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            opacity: 0.15;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        #app {
            position: relative;
            z-index: 10;
            width: 100%;
            max-width: 400px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .card-container {
            width: 100%;
            perspective: 1000px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 60px;
        }

        .card {
            background: var(--white);
            border-radius: 24px;
            padding: 30px 25px;
            width: 100%;
            box-shadow: 0 10px 30px rgba(233, 63, 63, 0.3), 0 4px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            position: relative;
            transform-style: preserve-3d;
        }

        #intro-card {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        #intro-card:active {
            transform: scale(0.98);
        }

        .big-question {
            font-family: 'Montserrat Alternates', sans-serif;
            font-size: 8rem;
            font-weight: 800;
            color: var(--jc-red);
            line-height: 1;
            margin-bottom: 20px;
            animation: pulse 2s infinite ease-in-out;
            text-shadow: 3px 3px 0px var(--jc-yellow);
        }

        .cta-text {
            font-family: 'Montserrat Alternates', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--jc-red);
        }

        #result-card {
            display: none;
            opacity: 0;
            transform: scale(0.9) translateY(20px);
            padding-bottom: 40px;
        }

        #result-card.visible {
            display: block;
            animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .profile-icon-container {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .profile-svg {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background-color: #FFE781;
            border-radius: 200%;
        }

        .profile-title {
            font-family: 'Montserrat Alternates', sans-serif;
            font-weight: 800;
            font-size: 1.6rem;
            line-height: 1.1;
            margin-bottom: 25px;
            color: var(--jc-red);
            text-transform: uppercase;
        }

        .stat-only-block {
            text-align: center;
            margin: 30px auto;
            padding: 20px;
            background: var(--jc-yellow);
            border-radius: 10px;
            font-size: 1.2rem;
            line-height: 1.4;
            font-weight: 600;
            color: var(--jc-red);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: translateY(10px);
        }

        .reveal-1 {
            animation: slideUpFade 0.5s ease forwards 0.3s;
        }

        .share-btn {
            background: var(--jc-red);
            color: var(--white);
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-family: 'Montserrat Alternates', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            margin-top: 20px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(233, 63, 63, 0.4);
            text-decoration: none;
            display: inline-block;
            animation: slideUpFade 0.5s ease forwards 0.7s;
            opacity: 0;
            transform: translateY(10px);
        }

        .logo-footer {
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            bottom: 0px;
            opacity: 0.9;
            z-index: 20;
            pointer-events: none;
        }

        .logo-footer img {
            fill: var(--white);
            height: 70px;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1) rotate(5deg);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes shake {

            10%,
            90% {
                transform: translate3d(-1px, 0, 0);
            }

            20%,
            80% {
                transform: translate3d(2px, 0, 0);
            }

            30%,
            50%,
            70% {
                transform: translate3d(-4px, 0, 0);
            }

            40%,
            60% {
                transform: translate3d(4px, 0, 0);
            }
        }

        @keyframes popIn {
            0% {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }

            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @keyframes slideUpFade {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- ZONE DE G√âN√âRATION (CACH√âE MAIS EXISTANTE) --- */
        #generator-container {
            position: fixed;
            top: 0;
            left: -10000px;
            /* On le sort de l'√©cran */
            width: 1080px;
            height: 1920px;
            overflow: hidden;
            background: white;
            /* Important pour le fond de l'image */
        }

        /* --- TON STYLE CANVAS ORIGINAL (Adapt√©) --- */
        .instagram-story {
            background-color: var(--principal);
            overflow: hidden;
            width: 1080px;
            height: 1920px;
            position: relative;
        }

        .instagram-story .ellipse {
            position: absolute;
            top: -1328px;
            left: -1024px;
            width: 2656px;
            height: 2656px;
            background-color: #ffe781;
            border-radius: 1328px;
        }

        .instagram-story .logo-mjcf {
            position: absolute;
            top: 1554px;
            left: 454px;
            width: 172px;
            height: 172px;
            aspect-ratio: 1;
        }

        .instagram-story .title {
            position: absolute;
            top: 276px;
            left: 110px;
            width: 868px;
            height: 129px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0px 9px 58.3px #00000040;
            font-family: "Montserrat Alternates", Helvetica, sans-serif;
            font-weight: 900;
            /* Black */
            color: #e83e3e;
            font-size: 90.8px;
            text-align: center;
            letter-spacing: 0;
            line-height: normal;
        }

        .instagram-story .profil-name {
            top: 875px;
            font-family: "Montserrat Alternates", Helvetica, sans-serif;
            font-weight: 900;
            /* Black */
            color: #e83e3e;
            font-size: 56.1px;
            position: absolute;
            left: 110px;
            width: 868px;
            height: 129px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0px 9px 58.3px #00000040;
            text-align: center;
            letter-spacing: 0;
            line-height: 1.1;
        }

        .instagram-story .profil-desc {
            top: 960px;
            font-family: "Montserrat Alternates", Helvetica, sans-serif;
            font-weight: 400;
            /* Regular */
            color: #000000;
            font-size: 34.7px;
            position: absolute;
            left: 110px;
            width: 868px;
            height: 129px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0px 9px 58.3px #00000040;
            text-align: center;
            letter-spacing: 0;
            line-height: normal;
        }

        .instagram-story .adhesion-text {
            top: 1425px;
            left: 130px;
            position: absolute;
            width: 868px;
            height: 129px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0px 9px 58.3px #00000040;
            font-family: "Poppins", Helvetica, sans-serif;
            font-weight: 600;
            /* SemiBold */
            color: #ffffff;
            font-size: 34.7px;
            text-align: center;
            letter-spacing: 0;
            line-height: normal;
        }

        .instagram-story .adhesion-socialmedia {
            top: 1727px;
            left: 110px;
            position: absolute;
            width: 868px;
            height: 129px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0px 9px 58.3px #00000040;
            font-family: "Poppins", Helvetica, sans-serif;
            font-weight: 600;
            color: #ffffff;
            font-size: 34.7px;
            text-align: center;
            letter-spacing: 0;
            line-height: normal;
        }

        .instagram-story .SVG-logo {
            position: absolute;
            top: 514px;
            left: 359px;
            width: 361px;
            height: 361px;
            border-radius: 200px;
            background-size: cover;
            background-position: 50% 50%;
            /* L'image sera inject√©e dynamiquement par JS */
        }
    </style>
</head>

<body>

    <div class="background-blobs"></div>
    <div class="noise-overlay"></div>

    <div id="app">
        <div class="card-container">
            <div class="card" id="intro-card" onclick="revealProfile()">
                <div class="big-question">?</div>
                <div class="cta-text">Ton profil militant</div>
                <div style="font-size: 0.9rem; opacity: 0.7; margin-top: 10px;">D√©couvre ta vraie nature politique</div>
            </div>

            <div class="card" id="result-card">
                <div id="dynamic-content"></div>
                <button class="share-btn" onclick="generateAndShare()">Partager en Story üì∏</button>
            </div>
        </div>

        <div class="logo-footer">
            <img src="Icons/logo.svg" alt="logo JC">
        </div>
    </div>

    <div id="generator-container">
        <div class="instagram-story">
            <div class="ellipse"></div>
            <img class="logo-mjcf" src="Icons/logo.svg" />
            <div class="title">Mon profil militant 2025 :</div>

            <div class="SVG-logo" id="gen-svg-logo"></div>
            <div class="profil-name" id="gen-profil-name">Nom du profil</div>
            <div class="profil-desc" id="gen-profil-desc">Description du profil</div>

            <div class="adhesion-text">Adh√®re au MJCF: jeunes-communistes.fr</div>
            <div class="adhesion-socialmedia">@mjcf_56 - linktr.ee/mjcf56</div>
        </div>
    </div>

    <script>
        // --- DONN√âES ---
        const profiles = [
            { title: "L'Anti-Capitaliste", svg: "Icons/Anti-Capitaliste.svg", stat: "A dit 'C'est la faute du profit' 850 fois cette ann√©e." },
            { title: "Le/La F√©ministe", svg: "Icons/F√©ministe.svg", stat: "0 tol√©rance pour les sexistes, m√™me de gauche." },
            { title: "L'Anti-Imp√©rialiste", svg: "Icons/Anti-Imp√©rialiste.svg", stat: "A manifest√© pour la Palestine tous les samedis." },
            { title: "L'√âcolo-Marxiste", svg: "Icons/√âcolo.svg", stat: "Pr√©f√®re nationaliser Total que trier ses emails." },
            { title: "L'anti-Parcoursup", svg: "Icons/S√©lection.svg", stat: "A maudit Parcoursup 4 000 fois en juin." },
            { title: "Le/La Prolo", svg: "Icons/Prolo.svg", stat: "A produit 10x son salaire pour la bo√Æte cette ann√©e." },
            { title: "L'Antifa", svg: "Icons/Antifa.svg", stat: "A d√©coll√© plus de stickers fafs qu'il n'a bu de caf√©s." },
            { title: "Le/La D√©fenseur du Public", svg: "Icons/D√©fenseur.svg", stat: "S'est √©nerv√©(e) 120 fois contre la casse de l'h√¥pital." },
            { title: "Le/La Pacifiste", svg: "Icons/Pacifiste.svg", stat: "A sign√© la p√©tition pour la paix avant tout le monde." },
            { title: "Le/La Militant(e)", svg: "Icons/Militant.svg", stat: "A distribu√© 3 000 tracts (et convaincu 50 personnes)." },
            { title: "Le/La R√©volutionnaire", svg: "Icons/R√©volutionnaire.svg", stat: "Optimisme r√©volutionnaire √† 100%." }
        ];

        let currentProfile = null;
        let isRevealed = false;

        // --- AFFICHAGE DU PROFIL (UI WEB) ---
        function revealProfile() {
            if (isRevealed) return;
            isRevealed = true;

            const introCard = document.getElementById('intro-card');
            const resultCard = document.getElementById('result-card');
            const contentContainer = document.getElementById('dynamic-content');

            introCard.classList.add('shake');

            const randomIndex = Math.floor(Math.random() * profiles.length);
            currentProfile = profiles[randomIndex];

            contentContainer.innerHTML = `
            <div class="profile-icon-container">
                <img src="${currentProfile.svg}" alt="${currentProfile.title}" class="profile-svg">
            </div>
            <h2 class="profile-title">${currentProfile.title}</h2>
            <div class="stat-only-block reveal-1">
                ${currentProfile.stat}
            </div>
        `;

            setTimeout(() => {
                introCard.style.display = 'none';
                resultCard.classList.add('visible');
                triggerConfetti();
            }, 600);
        }

        // --- G√âN√âRATION DE L'IMAGE AVEC HTML2CANVAS ---
        function generateAndShare() {
            if (!currentProfile) return;

            const btn = document.querySelector('.share-btn');
            const originalText = btn.innerText;
            btn.innerText = "G√©n√©ration...";
            btn.disabled = true;

            // 1. On remplit le template HTML cach√© avec les donn√©es du profil actuel
            document.getElementById('gen-profil-name').innerText = currentProfile.title.toUpperCase();
            document.getElementById('gen-profil-desc').innerText = currentProfile.stat;
            document.getElementById('gen-svg-logo').style.backgroundImage = `url(${currentProfile.svg})`;

            // 2. On attend un tout petit peu pour √™tre s√ªr que le DOM est √† jour (par s√©curit√©)
            setTimeout(() => {
                const elementToCapture = document.querySelector('.instagram-story');

                html2canvas(elementToCapture, {
                    scale: 1, // On garde l'√©chelle 1 car l'√©l√©ment fait d√©j√† 1080px de large
                    useCORS: true, // Important pour charger les images locales/externes
                    allowTaint: true,
                    backgroundColor: null // Fond transparent ou g√©r√© par le CSS
                }).then(canvas => {
                    // Cr√©ation du lien de t√©l√©chargement
                    const pngUrl = canvas.toDataURL('image/png');
                    const downloadLink = document.createElement('a');
                    downloadLink.href = pngUrl;
                    downloadLink.download = `profil-militant-${Date.now()}.png`;

                    document.body.appendChild(downloadLink);
                    downloadLink.click();
                    document.body.removeChild(downloadLink);

                    // Reset bouton
                    btn.innerText = originalText;
                    btn.disabled = false;
                }).catch(err => {
                    console.error("Erreur g√©n√©ration:", err);
                    alert("Erreur lors de la g√©n√©ration de l'image.");
                    btn.innerText = originalText;
                    btn.disabled = false;
                });
            }, 100);
        }

        function triggerConfetti() {
            var duration = 2500;
            var end = Date.now() + duration;
            (function frame() {
                confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#E93F3F', '#FFE781', '#ffffff'] });
                confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#E93F3F', '#FFE781', '#ffffff'] });
                if (Date.now() < end) { requestAnimationFrame(frame); }
            }());
        }
    </script>
</body>

</html>